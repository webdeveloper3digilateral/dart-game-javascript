<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Simple JS Darts Demo - Mobile</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #gameBox {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            max-width: 550px;
            max-height: 400px;
            background-image: url(media/beta-brd2.jpg);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            white-space: nowrap;
            overflow: hidden;
            transform-origin: top left;
        }

        #dart {
            position: absolute;
            visibility: hidden;
            background-image: url(media/dart-flight.gif);
            left: 300px;
            width: 57px;
            height: 400px;
        }

        #scoreA {
            position: absolute;
            left: 29px;
            top: 135px;
            width: 68px;
            height: 155px;
            text-align: center;
            font-size: 15px;
            color: rgb(255, 255, 255);
            font-weight: bold;
            overflow: hidden;
        }

        #power-back {
            position: absolute;
            visibility: hidden;
            left: 510px;
            top: 130px;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
            background-position: -36px 0px;
        }

        #power {
            position: absolute;
            visibility: hidden;
            left: 0;
            top: 0;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
        }

        #debug {
            width: 300px;
            height: 600px;
            overflow: auto;
        }

        #darts {
            position: absolute;
            top: 288px;
            left: 34px;
            width: 115px;
            height: 108px;
            background-image: url(media/darts.png);
        }

        #handCursor {
            position: absolute;
            top: 350px;
            left: 450px;
            width: 100px;
            height: 114px;
            background-image: url(media/hand-csr.gif);
        }

        #windIndicator {
            position: absolute;
            top: 11px;
            left: 481px;
            width: 58px;
            height: 58px;
        }

        .windCell {
            position: absolute;
            width: 9px;
            height: 9px;
            background-image: url(media/wind.gif);
        }

        /* Mobile touch controls */
        #touchControls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        #aimButton, #fireButton {
            display: inline-block;
            padding: 15px 30px;
            margin: 0 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        #aimButton:active, #fireButton:active {
            background: rgba(255, 255, 255, 0.3);
        }

        #aimButton.active {
            background: rgba(255, 0, 0, 0.7);
        }

        @media screen and (max-width: 600px) {
            #gameBox {
                transform: scale(0.8);
            }
        }

        @media screen and (max-width: 480px) {
            #gameBox {
                transform: scale(0.6);
            }
        }
    </style>
    <script>
        var SHOW_PROGRESS_BAR = 1;
        var WIND_ACTIVE = 1;

        var GAME_XRES = 550;
        var GAME_YRES = 400;

        var HAND_REF_X = 12;

        var BOARD_CENTER_X = 363;
        var BOARD_CENTER_Y = 201;
        var BOARD_RADIUS = 154;

        var OFFSET_POINT_X = 515;
        var OFFSET_POINT_Y = 176;

        var SEGMENT_COUNT = 20;
        var SEGMENT_SIZE = Math.PI / 10.0;

        var SEGMENTS = [10, 21, 77, 90, 141, 154];
        var SEGMENT_NAMES = ["50", "25", "value", "tripple", "value", "double", "out"];

        var angleOffset = Math.round(-Math.atan2(BOARD_CENTER_Y - OFFSET_POINT_Y, BOARD_CENTER_X - OFFSET_POINT_X) * (180.0 / Math.PI) + 180.0);

        var SCORE_VALUES = [6, 13, 4, 18, 1, 20, 5, 12, 9, 14, 11, 8, 16, 7, 19, 3, 17, 2, 15, 10, 6];

        var targetAngle = 0;
        var targetDelta = 0;
        var targetDX = 0;
        var targetDY = 0;

        var segmentIndex = 0;
        var segmentType = 0;
        var segmentAngle = 0;
        var segment = 0;
        var totalScore = 0;

        var DART_REF_X = 34;
        var DART_REF_Y = 66;

        var FLIGHT_ANIM_DELAY = 20;

        var dartCount = 3;
        var ligthOn = 0;

        var CURSOR_LEFT = 193;
        var CURSOR_RIGHT = 530;
        var CURSOR_TOP = 350;
        var CURSOR_BOTTOM = 380;

        var CURSOR_HOR_STEP = 10;
        var CURSOR_VER_STEP = 1;

        var cursor_hor = CURSOR_HOR_STEP;
        var cursor_ver = CURSOR_VER_STEP;

        var CURSOR_TIMER = 50;

        var hand_top = 350;
        var hand_left = 450;

        var cursorTimerId = 0;
        var dartTimerId = 1;

        var firing = 0;
        var aimingMode = false;

        var wind_angle = 0;
        var wind_phase = 0;

        var WIND_CELL_COUNT = 20;
        var WIND_TIMER = 300;

        var wind_cell_x = [WIND_CELL_COUNT];
        var wind_cell_y = [WIND_CELL_COUNT];

        var gameAngle = 0;
        var windStrenght = 0;

        var sprite_cellwidth = 57;
        var sprite_cellheight = 400;
        var sprite_cellnum = 21;
        var animId;

        // Mobile touch support
        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        function initMobileControls() {
            if (isMobile) {
                // Add touch controls
                var controlsDiv = document.createElement('div');
                controlsDiv.id = 'touchControls';
                controlsDiv.innerHTML = '<button id="aimButton">AIM</button><button id="fireButton">FIRE</button>';
                document.body.appendChild(controlsDiv);

                // Add touch event listeners
                document.getElementById('aimButton').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    startVerticalCursorMovement();
                });

                document.getElementById('fireButton').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    stopVerticalCursorMovement();
                });

                // Add tap-to-aim functionality
                document.getElementById('gameBox').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    if (!aimingMode) {
                        var rect = this.getBoundingClientRect();
                        var scaleX = GAME_XRES / rect.width;
                        var scaleY = GAME_YRES / rect.height;
                        
                        var touch = e.touches[0];
                        var x = (touch.clientX - rect.left) * scaleX;
                        var y = (touch.clientY - rect.top) * scaleY;
                        
                        // Move cursor to touch position
                        hand_left = Math.max(CURSOR_LEFT, Math.min(CURSOR_RIGHT, x - HAND_REF_X));
                        hand_top = Math.max(CURSOR_TOP, Math.min(CURSOR_BOTTOM, y));
                        moveCursor(hand_left, hand_top);
                    }
                });

                // Prevent default touch behaviors
                document.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('touchstart', function(e) {
                    if (e.target.tagName !== 'BUTTON') {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }

        // All your existing functions remain the same...
        function initWindIndicator(newAngle) {
            var wi = document.getElementById("windIndicator");

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newShadow = document.createElement("div");
                var divIdName = "shadow" + i;
                newShadow.setAttribute("id", divIdName);
                newShadow.setAttribute("class", "windCell");
                wi.appendChild(newShadow);
            }

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newCell = document.createElement("div");
                var divIdName = "cell" + i;
                newCell.setAttribute("id", divIdName);
                newCell.setAttribute("class", "windCell");
                wi.appendChild(newCell);
            }

            setWindAngle(newAngle);
            startWindAnimation();
        }

        function setWindAngle(newAngle) {
            wind_angle = newAngle;
            var rad = newAngle * (Math.PI / 180);
            var rad2 = rad - Math.PI;
            var radius = 23;
            var cx = 29;
            var cy = 29;
            var sx = Math.cos(rad2) * radius + cx;
            var sy = Math.sin(rad2) * radius + cy;
            var step = (radius * 2) / WIND_CELL_COUNT;
            var stp = 0;

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var px = sx + Math.cos(rad) * stp;
                var py = sy + Math.sin(rad) * stp;

                var sh = document.getElementById("shadow" + i);
                sh.style.top = Math.round(py) - 4 + "px";
                sh.style.left = Math.round(px) - 4 + "px";

                var cl = document.getElementById("cell" + i);
                cl.style.top = Math.round(py) - 4 + "px";
                cl.style.left = Math.round(px) - 4 + "px";

                if (WIND_CELL_COUNT - i > windStrenght) {
                    cl.style.backgroundPosition = "-9px 0px";
                } else {
                    cl.style.backgroundPosition = "-36px 0px";
                }
                stp += step;
            }
        }

        function startWindAnimation() {
            setInterval("doWindAnimation()", WIND_TIMER);
        }

        function doWindAnimation() {
            wind_phase++;
            if (wind_phase > 4) wind_phase = 0;

            for (i = 0; i < windStrenght; i++) {
                var state = (wind_phase + i) % 4;
                var offset = -(9 + state * 9);

                var cl = document.getElementById("cell" + (WIND_CELL_COUNT - windStrenght + i));
                cl.style.backgroundPosition = offset + "px 0px";
            }
        }

        function generateAngle() {
            gameAngle = Math.round(360 * Math.random());
            windStrenght = Math.round(15 * Math.random()) + 5;
            setWindAngle(gameAngle);
        }

        function getWindXOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var xo = Math.cos(a) * windStrenght;
            return Math.round(xo);
        }

        function getWindYOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var yo = Math.sin(a) * windStrenght;
            return Math.round(yo);
        }

        function initPowerBar(xpos, ypos) {
            var el = document.getElementById("power-back");
            el.style.visibility = "visible";
            el.style.top = ypos + "px";
            el.style.left = xpos + "px";

            var el2 = document.getElementById("power");
            el2.style.visibility = "visible";
            setPowerBarProgress(0);
        }

        function setPowerBarProgress(val) {
            var el = document.getElementById("power");
            el.style.backgroundPosition = "0px " + -(139 - val) + "px";
            el.style.top = 140 - val + "px";
            el.style.height = 150 - (139 - val) + "px";
        }

        function hidePowerBar() {
            var el = document.getElementById("power-back");
            el.style.visibility = "hidden";
            var el2 = document.getElementById("power");
            el2.style.visibility = "hidden";
        }

        function initCursor() {
            hand_left = CURSOR_LEFT;
            hand_top = CURSOR_TOP;
        }

        function moveCursor(newX, newY) {
            hand_left = newX;
            hand_top = newY;
            var dart = document.getElementById("handCursor");
            dart.style.left = hand_left + "px";
            dart.style.top = hand_top + "px";
        }

        function doHorizontalCursorMovement() {
            hand_left += cursor_hor;

            if (cursor_hor > 0 && hand_left >= CURSOR_RIGHT) {
                hand_left = CURSOR_RIGHT;
                cursor_hor *= -1;
            }

            if (cursor_hor < 0 && hand_left < CURSOR_LEFT) {
                hand_left = CURSOR_LEFT;
                cursor_hor *= -1;
            }

            moveCursor(hand_left, hand_top);
        }

        function doVerticalCursorMovement() {
            hand_top += cursor_ver;

            if (cursor_ver > 0 && hand_top > CURSOR_BOTTOM) {
                hand_top = CURSOR_BOTTOM;
                cursor_ver *= -1;
            }

            if (cursor_ver < 0 && hand_top < CURSOR_TOP) {
                hand_top = CURSOR_TOP;
                cursor_ver *= -1;
            }

            if (SHOW_PROGRESS_BAR == 1) {
                var prog = (hand_top - CURSOR_TOP) * (130 / (CURSOR_BOTTOM - CURSOR_TOP));
                setPowerBarProgress(prog);
            }

            moveCursor(hand_left, hand_top);
        }

        function startHorizontalCursorMovement() {
            initCursor();
            var el = document.getElementById("handCursor");
            el.style.backgroundPosition = "0px 0px";
            cursorTimerId = setInterval("doHorizontalCursorMovement()", CURSOR_TIMER);
        }

        function stopHorizontalCursorMovement() {
            clearInterval(cursorTimerId);
        }

        function startVerticalCursorMovement() {
            if (firing == 0) {
                aimingMode = true;
                stopHorizontalCursorMovement();
                cursorTimerId = setInterval("doVerticalCursorMovement()", CURSOR_TIMER);
                firing = 1;

                if (SHOW_PROGRESS_BAR == 1) {
                    initPowerBar(510, 130);
                }

                // Update button state on mobile
                if (isMobile) {
                    document.getElementById("aimButton").classList.add("active");
                }
            }
        }

        function stopVerticalCursorMovement() {
            firing = 0;
            aimingMode = false;
            clearInterval(cursorTimerId);

            var fireY = 360 - (hand_top - CURSOR_TOP) * ((BOARD_RADIUS * 2 + 20) / 30) - DART_REF_Y;

            if (WIND_ACTIVE == 1) {
                fireDart(hand_left - DART_REF_X + HAND_REF_X + getWindXOffset() * 4, fireY + getWindYOffset() * 4);
            } else {
                fireDart(hand_left - DART_REF_X + HAND_REF_X, fireY);
            }

            initCursor();
            var el = document.getElementById("handCursor");
            el.style.backgroundPosition = "-100px 0px";

            if (SHOW_PROGRESS_BAR == 1) {
                hidePowerBar();
            }

            // Update button state on mobile
            if (isMobile) {
                document.getElementById("aimButton").classList.remove("active");
            }

            setTimeout("startHorizontalCursorMovement()", 500);
        }

        function mouseHandler(evt) {
            if (isMobile) return; // Disable mouse events on mobile

            var node = evt.target ? evt.target : evt.srcElement ? evt.srcElement : null;
            evt = evt ? evt : event ? event : null;

            var xpo = evt.clientX;
            var ypo = evt.clientY;

            var rx = xpo - 350;
            var ry = ypo - 150;

            computeHit(rx, ry);
            generateScore();
            addScoreA(totalScore);
        }

        function fireDart(tarX, tarY) {
            var dart = document.getElementById("dart");
            dart.style.left = tarX + "px";
            dart.style.top = tarY + "px";
            dart.style.visibility = "visible";

            computeHit(tarX + DART_REF_X, tarY + DART_REF_Y);
            generateScore();
            addScoreA(totalScore);

            dartCount--;
            if (dartCount == 0) {
                generateAngle();
                dartCount = 3;
            }
            renderIndicator();
            doFlightAnim(0);
        }

        function generateScore() {
            if (SEGMENT_NAMES[segmentType] == "out") {
                totalScore = 0;
            } else if (SEGMENT_NAMES[segmentType] == "50") {
                totalScore = 50;
            } else {
                if (SEGMENT_NAMES[segmentType] == "25") {
                    totalScore = 25;
                } else {
                    totalScore = SCORE_VALUES[segment];
                    if (SEGMENT_NAMES[segmentType] == "double") totalScore *= 2;
                    if (SEGMENT_NAMES[segmentType] == "tripple") totalScore *= 3;
                }
            }
        }

        function computeHit(xpos, ypos) {
            var dx = BOARD_CENTER_X - xpos;
            var dy = BOARD_CENTER_Y - ypos;
            var angle = Math.atan2(dy, dx);
            var delta = Math.sqrt(dx * dx + dy * dy);

            var sg = 0;
            for (i = 0; i < 6; i++) {
                if (delta > SEGMENTS[i]) sg = i + 1;
            }

            segmentType = sg;
            segmentIndex = Math.round(-angle * (180.0 / Math.PI) + 180.0);
            segment = Math.round(segmentIndex / (360.0 / SEGMENT_COUNT));
        }

        function addScoreA(msg) {
            var ni = document.getElementById("scoreA");
            var newpar = document.createElement("i");
            newpar.innerHTML = "" + msg + "<br>";
            ni.appendChild(newpar);

            var objDiv = document.getElementById("scoreA");
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function showcell(x, y, id) {
            var el = document.getElementById(id);
            var cx = -(x * sprite_cellwidth);
            var cy = -(y * sprite_cellheight);
            el.style.backgroundPosition = cx + "px " + cy + "px";
        }

        function doFlightAnim(step) {
            dartTimerId = clearTimeout(animId);
            if (step <= 20) {
                showcell(step, 0, "dart");
                dartTimerId = setTimeout("doFlightAnim(" + (step + 1) + ");", FLIGHT_ANIM_DELAY);
            }
        }

        function renderIndicator() {
            var width = dartCount * 35;
            var drt = document.getElementById("darts");
            drt.style.width = width + "px";
        }

        // Responsive scaling function
        function scaleGame() {
            var gameBox = document.getElementById('gameBox');
            var windowWidth = window.innerWidth;
            var windowHeight = window.innerHeight;
            
            var scaleX = windowWidth / GAME_XRES;
            var scaleY = windowHeight / GAME_YRES;
            var scale = Math.min(scaleX, scaleY, 1);
            
            gameBox.style.transform = 'scale(' + scale + ')';
            gameBox.style.transformOrigin = 'top left';
        }

        // Initialize everything
        window.addEventListener('load', function() {
            initMobileControls();
            startHorizontalCursorMovement();
            initPowerBar(10, 10);
            hidePowerBar();
            initWindIndicator(45);
            generateAngle();
            scaleGame();
        });

        window.addEventListener('resize', scaleGame);

        // Prevent zoom on double tap
        var lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            var now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</head>

<body onmouseup="mouseHandler(event)" onkeydown="startVerticalCursorMovement()" onkeyup="stopVerticalCursorMovement()">
    <div id="gameBox">
        <div id="windIndicator"></div>
        <div id="darts"></div>
        <div id="power-back" style="visibility: hidden; top: 10px; left: 10px">
            <div id="power" style="visibility: hidden; background-position: 0px -139px; top: 140px; height: 11px;"></div>
        </div>
        <div id="handCursor" style="background-position: 0px 0px; left: 380px; top: 350px"></div>
        <div id="scoreA"></div>
        <div id="dart">&nbsp;</div>
    </div>
</body>
</html> -->



 <!-- <script>
        var SHOW_PROGRESS_BAR = 1;
        var WIND_ACTIVE = 1;

        var GAME_XRES = 550;
        var GAME_YRES = 400;

        var HAND_REF_X = 12;

        var BOARD_CENTER_X = 363;
        var BOARD_CENTER_Y = 201;
        var BOARD_RADIUS = 154;

        var OFFSET_POINT_X = 515;
        var OFFSET_POINT_Y = 176;

        var SEGMENT_COUNT = 20;
        var SEGMENT_SIZE = Math.PI / 10.0;

        var SEGMENTS = [10, 21, 77, 90, 141, 154];
        var SEGMENT_NAMES = ["50", "25", "value", "tripple", "value", "double", "out"];

        var angleOffset = Math.round(-Math.atan2(BOARD_CENTER_Y - OFFSET_POINT_Y, BOARD_CENTER_X - OFFSET_POINT_X) * (180.0 / Math.PI) + 180.0);

        var SCORE_VALUES = [6, 13, 4, 18, 1, 20, 5, 12, 9, 14, 11, 8, 16, 7, 19, 3, 17, 2, 15, 10, 6];

        var targetAngle = 0;
        var targetDelta = 0;
        var targetDX = 0;
        var targetDY = 0;

        var segmentIndex = 0;
        var segmentType = 0;
        var segmentAngle = 0;
        var segment = 0;
        var totalScore = 0;

        var DART_REF_X = 34;
        var DART_REF_Y = 66;

        var FLIGHT_ANIM_DELAY = 20;

        var dartCount = 3;
        var ligthOn = 0;

        var CURSOR_LEFT = 193;
        var CURSOR_RIGHT = 530;
        var CURSOR_TOP = 350;
        var CURSOR_BOTTOM = 380;

        var CURSOR_HOR_STEP = 10;
        var CURSOR_VER_STEP = 1;

        var cursor_hor = CURSOR_HOR_STEP;
        var cursor_ver = CURSOR_VER_STEP;

        var CURSOR_TIMER = 50;

        var hand_top = 350;
        var hand_left = 450;

        var cursorTimerId = 0;
        var dartTimerId = 1;

        var firing = 0;
        var aimingMode = false;

        var wind_angle = 0;
        var wind_phase = 0;

        var WIND_CELL_COUNT = 20;
        var WIND_TIMER = 300;

        var wind_cell_x = [WIND_CELL_COUNT];
        var wind_cell_y = [WIND_CELL_COUNT];

        var gameAngle = 0;
        var windStrenght = 0;

        var sprite_cellwidth = 57;
        var sprite_cellheight = 400;
        var sprite_cellnum = 21;
        var animId;

        // Single player game variables
        var playerScore = 0;
        var roundNumber = 1;
        var maxRounds = 3;
        var gameActive = true;

        // Mobile touch support
        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        function initMobileControls() {
            if (isMobile) {
                // Add touch controls
                var controlsDiv = document.createElement('div');
                controlsDiv.id = 'touchControls';
                controlsDiv.innerHTML = '<button id="aimButton">AIM</button><button id="fireButton">FIRE</button>';
                document.body.appendChild(controlsDiv);

                // Add touch event listeners
                document.getElementById('aimButton').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    startVerticalCursorMovement();
                });

                document.getElementById('fireButton').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    stopVerticalCursorMovement();
                });

                // Add tap-to-aim functionality
                document.getElementById('gameBox').addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    if (!aimingMode) {
                        var rect = this.getBoundingClientRect();
                        var scaleX = GAME_XRES / rect.width;
                        var scaleY = GAME_YRES / rect.height;
                        
                        var touch = e.touches[0];
                        var x = (touch.clientX - rect.left) * scaleX;
                        var y = (touch.clientY - rect.top) * scaleY;
                        
                        // Move cursor to touch position
                        hand_left = Math.max(CURSOR_LEFT, Math.min(CURSOR_RIGHT, x - HAND_REF_X));
                        hand_top = Math.max(CURSOR_TOP, Math.min(CURSOR_BOTTOM, y));
                        moveCursor(hand_left, hand_top);
                    }
                });

                // Prevent default touch behaviors
                document.addEventListener('touchmove', function(e) {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('touchstart', function(e) {
                    if (e.target.tagName !== 'BUTTON') {
                        e.preventDefault();
                    }
                }, { passive: false });
            }
        }

        function initGameUI() {
            var uiDiv = document.createElement('div');
            uiDiv.id = 'gameUI';
            uiDiv.innerHTML = `
                <h2>Darts Game</h2>
                <div>Round: <span id="roundDisplay">${roundNumber}/${maxRounds}</span></div>
                <div>Score: <span id="scoreDisplay">${playerScore}</span></div>
                <div>Darts: <span id="dartsDisplay">${dartCount}</span></div>
            `;
            document.body.appendChild(uiDiv);
        }

        function updateGameUI() {
            document.getElementById('roundDisplay').textContent = `${roundNumber}/${maxRounds}`;
            document.getElementById('scoreDisplay').textContent = playerScore;
            document.getElementById('dartsDisplay').textContent = dartCount;
        }

        function checkGameEnd() {
            if (roundNumber > maxRounds) {
                gameActive = false;
                showGameOver();
            }
        }

        function showGameOver() {
            var gameOverScreen = document.createElement('div');
            gameOverScreen.id = 'gameOverScreen';
            gameOverScreen.innerHTML = `
                <h1>Game Over!</h1>
                <p>Final Score: ${playerScore}</p>
                <p>Rounds Completed: ${roundNumber - 1}</p>
                <button id="restartButton">Play Again</button>
            `;
            document.body.appendChild(gameOverScreen);
            gameOverScreen.style.display = 'flex';
            
            document.getElementById('restartButton').addEventListener('click', restartGame);
        }

        function restartGame() {
            playerScore = 0;
            roundNumber = 1;
            dartCount = 3;
            gameActive = true;
            
            document.getElementById('gameOverScreen').remove();
            updateGameUI();
            
            // Reset wind
            generateAngle();
            
            // Reset cursor
            initCursor();
            startHorizontalCursorMovement();
        }

        function nextRound() {
            roundNumber++;
            dartCount = 3;
            updateGameUI();
            checkGameEnd();
            
            // Generate new wind for the next round
            if (gameActive) {
                generateAngle();
            }
        }

        // All your existing functions remain the same...
        function initWindIndicator(newAngle) {
            var wi = document.getElementById("windIndicator");

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newShadow = document.createElement("div");
                var divIdName = "shadow" + i;
                newShadow.setAttribute("id", divIdName);
                newShadow.setAttribute("class", "windCell");
                wi.appendChild(newShadow);
            }

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newCell = document.createElement("div");
                var divIdName = "cell" + i;
                newCell.setAttribute("id", divIdName);
                newCell.setAttribute("class", "windCell");
                wi.appendChild(newCell);
            }

            setWindAngle(newAngle);
            startWindAnimation();
        }

        function setWindAngle(newAngle) {
            wind_angle = newAngle;
            var rad = newAngle * (Math.PI / 180);
            var rad2 = rad - Math.PI;
            var radius = 23;
            var cx = 29;
            var cy = 29;
            var sx = Math.cos(rad2) * radius + cx;
            var sy = Math.sin(rad2) * radius + cy;
            var step = (radius * 2) / WIND_CELL_COUNT;
            var stp = 0;

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var px = sx + Math.cos(rad) * stp;
                var py = sy + Math.sin(rad) * stp;

                var sh = document.getElementById("shadow" + i);
                sh.style.top = Math.round(py) - 4 + "px";
                sh.style.left = Math.round(px) - 4 + "px";

                var cl = document.getElementById("cell" + i);
                cl.style.top = Math.round(py) - 4 + "px";
                cl.style.left = Math.round(px) - 4 + "px";

                if (WIND_CELL_COUNT - i > windStrenght) {
                    cl.style.backgroundPosition = "-9px 0px";
                } else {
                    cl.style.backgroundPosition = "-36px 0px";
                }
                stp += step;
            }
        }

        function startWindAnimation() {
            setInterval("doWindAnimation()", WIND_TIMER);
        }

        function doWindAnimation() {
            wind_phase++;
            if (wind_phase > 4) wind_phase = 0;

            for (i = 0; i < windStrenght; i++) {
                var state = (wind_phase + i) % 4;
                var offset = -(9 + state * 9);

                var cl = document.getElementById("cell" + (WIND_CELL_COUNT - windStrenght + i));
                cl.style.backgroundPosition = offset + "px 0px";
            }
        }

        function generateAngle() {
            gameAngle = Math.round(360 * Math.random());
            windStrenght = Math.round(15 * Math.random()) + 5;
            setWindAngle(gameAngle);
        }

        function getWindXOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var xo = Math.cos(a) * windStrenght;
            return Math.round(xo);
        }

        function getWindYOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var yo = Math.sin(a) * windStrenght;
            return Math.round(yo);
        }

        function initPowerBar(xpos, ypos) {
            var el = document.getElementById("power-back");
            el.style.visibility = "visible";
            el.style.top = ypos + "px";
            el.style.left = xpos + "px";

            var el2 = document.getElementById("power");
            el2.style.visibility = "visible";
            setPowerBarProgress(0);
        }

        function setPowerBarProgress(val) {
            var el = document.getElementById("power");
            el.style.backgroundPosition = "0px " + -(139 - val) + "px";
            el.style.top = 140 - val + "px";
            el.style.height = 150 - (139 - val) + "px";
        }

        function hidePowerBar() {
            var el = document.getElementById("power-back");
            el.style.visibility = "hidden";
            var el2 = document.getElementById("power");
            el2.style.visibility = "hidden";
        }

        function initCursor() {
            hand_left = CURSOR_LEFT;
            hand_top = CURSOR_TOP;
        }

        function moveCursor(newX, newY) {
            hand_left = newX;
            hand_top = newY;
            var dart = document.getElementById("handCursor");
            dart.style.left = hand_left + "px";
            dart.style.top = hand_top + "px";
        }

        function doHorizontalCursorMovement() {
            hand_left += cursor_hor;

            if (cursor_hor > 0 && hand_left >= CURSOR_RIGHT) {
                hand_left = CURSOR_RIGHT;
                cursor_hor *= -1;
            }

            if (cursor_hor < 0 && hand_left < CURSOR_LEFT) {
                hand_left = CURSOR_LEFT;
                cursor_hor *= -1;
            }

            moveCursor(hand_left, hand_top);
        }

        function doVerticalCursorMovement() {
            hand_top += cursor_ver;

            if (cursor_ver > 0 && hand_top > CURSOR_BOTTOM) {
                hand_top = CURSOR_BOTTOM;
                cursor_ver *= -1;
            }

            if (cursor_ver < 0 && hand_top < CURSOR_TOP) {
                hand_top = CURSOR_TOP;
                cursor_ver *= -1;
            }

            if (SHOW_PROGRESS_BAR == 1) {
                var prog = (hand_top - CURSOR_TOP) * (130 / (CURSOR_BOTTOM - CURSOR_TOP));
                setPowerBarProgress(prog);
            }

            moveCursor(hand_left, hand_top);
        }

        function startHorizontalCursorMovement() {
            initCursor();
            var el = document.getElementById("handCursor");
            el.style.backgroundPosition = "0px 0px";
            cursorTimerId = setInterval("doHorizontalCursorMovement()", CURSOR_TIMER);
        }

        function stopHorizontalCursorMovement() {
            clearInterval(cursorTimerId);
        }

        function startVerticalCursorMovement() {
            if (firing == 0 && gameActive) {
                aimingMode = true;
                stopHorizontalCursorMovement();
                cursorTimerId = setInterval("doVerticalCursorMovement()", CURSOR_TIMER);
                firing = 1;

                if (SHOW_PROGRESS_BAR == 1) {
                    initPowerBar(510, 130);
                }

                // Update button state on mobile
                if (isMobile) {
                    document.getElementById("aimButton").classList.add("active");
                }
            }
        }

        function stopVerticalCursorMovement() {
            if (!gameActive) return;
            
            firing = 0;
            aimingMode = false;
            clearInterval(cursorTimerId);

            var fireY = 360 - (hand_top - CURSOR_TOP) * ((BOARD_RADIUS * 2 + 20) / 30) - DART_REF_Y;

            if (WIND_ACTIVE == 1) {
                fireDart(hand_left - DART_REF_X + HAND_REF_X + getWindXOffset() * 4, fireY + getWindYOffset() * 4);
            } else {
                fireDart(hand_left - DART_REF_X + HAND_REF_X, fireY);
            }

            initCursor();
            var el = document.getElementById("handCursor");
            el.style.backgroundPosition = "-100px 0px";

            if (SHOW_PROGRESS_BAR == 1) {
                hidePowerBar();
            }

            // Update button state on mobile
            if (isMobile) {
                document.getElementById("aimButton").classList.remove("active");
            }

            setTimeout("startHorizontalCursorMovement()", 500);
        }

        function mouseHandler(evt) {
            if (isMobile) return; // Disable mouse events on mobile

            var node = evt.target ? evt.target : evt.srcElement ? evt.srcElement : null;
            evt = evt ? evt : event ? event : null;

            var xpo = evt.clientX;
            var ypo = evt.clientY;

            var rx = xpo - 350;
            var ry = ypo - 150;

            computeHit(rx, ry);
            generateScore();
            addScoreA(totalScore);
        }

        function fireDart(tarX, tarY) {
            var dart = document.getElementById("dart");
            dart.style.left = tarX + "px";
            dart.style.top = tarY + "px";
            dart.style.visibility = "visible";

            computeHit(tarX + DART_REF_X, tarY + DART_REF_Y);
            generateScore();
            
            // Add to player score
            playerScore += totalScore;
            
            addScoreA(totalScore);

            dartCount--;
            if (dartCount == 0) {
                nextRound();
            }
            updateGameUI();
            renderIndicator();
            doFlightAnim(0);
        }

        function generateScore() {
            if (SEGMENT_NAMES[segmentType] == "out") {
                totalScore = 0;
            } else if (SEGMENT_NAMES[segmentType] == "50") {
                totalScore = 50;
            } else {
                if (SEGMENT_NAMES[segmentType] == "25") {
                    totalScore = 25;
                } else {
                    totalScore = SCORE_VALUES[segment];
                    if (SEGMENT_NAMES[segmentType] == "double") totalScore *= 2;
                    if (SEGMENT_NAMES[segmentType] == "tripple") totalScore *= 3;
                }
            }
        }

        function computeHit(xpos, ypos) {
            var dx = BOARD_CENTER_X - xpos;
            var dy = BOARD_CENTER_Y - ypos;
            var angle = Math.atan2(dy, dx);
            var delta = Math.sqrt(dx * dx + dy * dy);

            var sg = 0;
            for (i = 0; i < 6; i++) {
                if (delta > SEGMENTS[i]) sg = i + 1;
            }

            segmentType = sg;
            segmentIndex = Math.round(-angle * (180.0 / Math.PI) + 180.0);
            segment = Math.round(segmentIndex / (360.0 / SEGMENT_COUNT));
        }

        function addScoreA(msg) {
            var ni = document.getElementById("scoreA");
            var newpar = document.createElement("i");
            newpar.innerHTML = "" + msg + "<br>";
            ni.appendChild(newpar);

            var objDiv = document.getElementById("scoreA");
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function showcell(x, y, id) {
            var el = document.getElementById(id);
            var cx = -(x * sprite_cellwidth);
            var cy = -(y * sprite_cellheight);
            el.style.backgroundPosition = cx + "px " + cy + "px";
        }

        function doFlightAnim(step) {
            dartTimerId = clearTimeout(animId);
            if (step <= 20) {
                showcell(step, 0, "dart");
                dartTimerId = setTimeout("doFlightAnim(" + (step + 1) + ");", FLIGHT_ANIM_DELAY);
            }
        }

        function renderIndicator() {
            var width = dartCount * 35;
            var drt = document.getElementById("darts");
            drt.style.width = width + "px";
        }

        // Responsive scaling function
        function scaleGame() {
            var gameBox = document.getElementById('gameBox');
            var windowWidth = window.innerWidth;
            var windowHeight = window.innerHeight;
            
            var scaleX = windowWidth / GAME_XRES;
            var scaleY = windowHeight / GAME_YRES;
            var scale = Math.min(scaleX, scaleY, 1);
            
            gameBox.style.transform = 'scale(' + scale + ')';
            gameBox.style.transformOrigin = 'top left';
        }

        // Initialize everything
        window.addEventListener('load', function() {
            initGameUI();
            initMobileControls();
            startHorizontalCursorMovement();
            initPowerBar(10, 10);
            hidePowerBar();
            initWindIndicator(45);
            generateAngle();
            scaleGame();
        });

        window.addEventListener('resize', scaleGame);

        // Prevent zoom on double tap
        var lastTouchEnd = 0;
        document.addEventListener('touchend', function (event) {
            var now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script> -->






<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    
    <title>Single Player Darts Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background: #1a1a2e;
            font-family: Arial, sans-serif;
        }

        /* #gameBox {
            position: absolute;
            top: 150px;
            left: 0;
            width: 100%;
            height: 100%;
            max-width: 550px;
            max-height: 400px;
            background-image: url(media/beta-brd2.jpg);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            white-space: nowrap;
            overflow: hidden;
            transform-origin: top left;
        } */
         #gameBox {
    position: absolute;
    top: 150px; /* or 150px if you need some top spacing */
    left: 0;
    width: 100%;          /* Full width of the screen */
    height: auto;         /* Let height adjust based on image */
    max-width: 100%;      /* Ensure it doesn't overflow horizontally */
    background-image: url(media/beta-brd2.jpg);
    background-size: contain;  /* Contain the image within the box */
    background-repeat: no-repeat;
    background-position: center;
    white-space: nowrap;
    overflow: hidden;
    transform-origin: top left;
}


        #dart {
            position: absolute;
            visibility: hidden;
            background-image: url(media/dart-flight.gif);
          
            left: 300px;
            width: 57px;
            height: 400px;
        }

        /* #scoreA {
            position: absolute;
            left: 29px;
            top: 135px;
            width: 68px;
            height: 155px;
            text-align: center;
            font-size: 15px;
            color: rgb(255, 255, 255);
            font-weight: bold;
            overflow: hidden;
        } */

        #power-back {
            position: absolute;
            visibility: hidden;
            left: 510px;
            top: 130px;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
            background-position: -36px 0px;
        }

        #power {
            position: absolute;
            visibility: hidden;
            left: 0;
            top: 0;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
        }

        #darts {
            position: absolute;
            top: 288px;
            left: 34px;
            width: 115px;
            height: 108px;
            background-image: url(media/darts.png);
        }

        #handCursor {
            position: absolute;
            top: 350px;
            left: 450px;
            width: 100px;
            height: 114px;
            background-image: url(media/hand-csr.gif);
        }

        /* #windIndicator {
            position: absolute;
            top: 11px;
            left: 481px;
            width: 58px;
            height: 58px;
        } */

        /* .windCell {
            position: absolute;
            width: 9px;
            height: 9px;
            background-image: url(media/wind.gif);
        } */

        /* Game UI */
        #gameUI {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(184, 32, 32, 0.7);
            color: rgb(214, 15, 15);
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            min-width: 150px;
        }

        #gameUI h2 {
            margin: 0 0 10px 0;
            font-size: 16px;
            text-align: center;
            color: #ffcc00;
        }

        #gameUI div {
            margin: 5px 0;
        }

        #gameUI span {
            font-weight: bold;
            color: #ffcc00;
        }

        /* Mobile touch controls */
        #touchControls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
        }

        #aimButton, #fireButton {
            display: inline-block;
            padding: 15px 30px;
            margin: 0 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: 2px solid white;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        #aimButton:active, #fireButton:active {
            background: rgba(255, 255, 255, 0.3);
        }

        #aimButton.active {
            background: rgba(255, 0, 0, 0.7);
        }

        /* Game Over Screen */
        #gameOverScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }

        #gameOverScreen h1 {
            font-size: 36px;
            color: #ffcc00;
            margin-bottom: 20px;
        }

        #gameOverScreen p {
            font-size: 24px;
            margin: 10px 0;
        }

        #restartButton {
            padding: 15px 30px;
            margin-top: 20px;
            background: #ffcc00;
            color: #000;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        @media screen and (max-width: 600px) {
            #gameBox {
                transform: scale(0.8);
            }
        }

        @media screen and (max-width: 480px) {
            #gameBox {
                transform: scale(0.6);
            }
        }
    </style>
   <script>
        var SHOW_PROGRESS_BAR = 1;
var WIND_ACTIVE = 1;

var GAME_XRES = 550;
var GAME_YRES = 400;

var HAND_REF_X = 12;

var BOARD_CENTER_X = 363;
var BOARD_CENTER_Y = 201;
var BOARD_RADIUS = 154;

var OFFSET_POINT_X = 515;
var OFFSET_POINT_Y = 176;

var SEGMENT_COUNT = 20;
var SEGMENT_SIZE = Math.PI / 10.0;

var SEGMENTS = [10, 21, 77, 90, 141, 154];
var SEGMENT_NAMES = ["50", "25", "value", "tripple", "value", "double", "out"];

var angleOffset = Math.round(-Math.atan2(BOARD_CENTER_Y - OFFSET_POINT_Y, BOARD_CENTER_X - OFFSET_POINT_X) * (180.0 / Math.PI) + 180.0);

var SCORE_VALUES = [6, 13, 4, 18, 1, 20, 5, 12, 9, 14, 11, 8, 16, 7, 19, 3, 17, 2, 15, 10, 6];

var targetAngle = 0;
var targetDelta = 0;
var targetDX = 0;
var targetDY = 0;

var segmentIndex = 0;
var segmentType = 0;
var segmentAngle = 0;
var segment = 0;
var totalScore = 0;

var DART_REF_X = 34;
var DART_REF_Y = 66;

var FLIGHT_ANIM_DELAY = 20;

var dartCount = 3;
var ligthOn = 0;

var CURSOR_LEFT = 193;
var CURSOR_RIGHT = 530;
var CURSOR_TOP = 350;
var CURSOR_BOTTOM = 380;

var CURSOR_HOR_STEP = 15; // Movement step for manual controls
var CURSOR_VER_STEP = 1;

var cursor_ver = CURSOR_VER_STEP;
var CURSOR_TIMER = 50;

var hand_top = 350;
var hand_left = 450;

var cursorTimerId = 0;
var dartTimerId = 1;

var firing = 0;
var aimingMode = false;
var horizontalMovementActive = false; // New flag to control automatic movement

var wind_angle = 0;
var wind_phase = 0;

var WIND_CELL_COUNT = 20;
var WIND_TIMER = 300;

var wind_cell_x = [WIND_CELL_COUNT];
var wind_cell_y = [WIND_CELL_COUNT];

var gameAngle = 0;
var windStrenght = 0;

var sprite_cellwidth = 57;
var sprite_cellheight = 400;
var sprite_cellnum = 21;
var animId;

// Single player game variables
var playerScore = 0;
var roundNumber = 1;
var maxRounds = 3;
var gameActive = true;


// Mobile touch support
var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

// Manual movement functions [web:6][web:43]
function moveLeft() {
    if (!aimingMode && !firing && gameActive) {
        hand_left -= CURSOR_HOR_STEP;
        if (hand_left < CURSOR_LEFT) {
            hand_left = CURSOR_LEFT;
        }
        moveCursor(hand_left, hand_top);
    }
}

function moveRight() {
    if (!aimingMode && !firing && gameActive) {
        hand_left += CURSOR_HOR_STEP;
        if (hand_left > CURSOR_RIGHT) {
            hand_left = CURSOR_RIGHT;
        }
        moveCursor(hand_left, hand_top);
    }
}

function initMobileControls() {
    // Add touch controls with left/right buttons [web:6][web:44]
    var controlsDiv = document.createElement('div');
    controlsDiv.id = 'touchControls';
    controlsDiv.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 20px;
        z-index: 1000;
        background: rgba(0,0,0,0.8);
        padding: 15px;
        border-radius: 10px;
    `;
    
    controlsDiv.innerHTML = `
        <button id="leftButton" style="
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        ">←</button>
        <button id="rightButton" style="
            width: 60px;
            height: 60px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        ">→</button>
        <button id="aimButton" style="
            width: 80px;
            height: 60px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        ">AIM</button>
        <button id="fireButton" style="
            width: 80px;
            height: 60px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        ">FIRE</button>
    `;
    
    document.body.appendChild(controlsDiv);

    // Add event listeners for manual movement [web:6][web:9]
    var leftBtn = document.getElementById('leftButton');
    var rightBtn = document.getElementById('rightButton');
    var aimBtn = document.getElementById('aimButton');
    var fireBtn = document.getElementById('fireButton');

    // Left button events
    leftBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        moveLeft();
        leftBtn.style.transform = 'scale(0.95)';
    });
    leftBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        leftBtn.style.transform = 'scale(1)';
    });
    leftBtn.addEventListener('click', function(e) {
        e.preventDefault();
        moveLeft();
    });

    // Right button events
    rightBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        moveRight();
        rightBtn.style.transform = 'scale(0.95)';
    });
    rightBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        rightBtn.style.transform = 'scale(1)';
    });
    rightBtn.addEventListener('click', function(e) {
        e.preventDefault();
        moveRight();
    });

    // Aim button events
    aimBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        startVerticalCursorMovement();
        aimBtn.style.transform = 'scale(0.95)';
    });
    aimBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        aimBtn.style.transform = 'scale(1)';
    });
    aimBtn.addEventListener('click', function(e) {
        e.preventDefault();
        startVerticalCursorMovement();
    });

    // Fire button events
    fireBtn.addEventListener('touchstart', function(e) {
        e.preventDefault();
        stopVerticalCursorMovement();
        fireBtn.style.transform = 'scale(0.95)';
    });
    fireBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        fireBtn.style.transform = 'scale(1)';
    });
    fireBtn.addEventListener('click', function(e) {
        e.preventDefault();
        stopVerticalCursorMovement();
    });

    // Prevent default touch behaviors [web:6]
    document.addEventListener('touchmove', function(e) {
        e.preventDefault();
    }, { passive: false });

    document.addEventListener('touchstart', function(e) {
        if (e.target.tagName !== 'BUTTON') {
            e.preventDefault();
        }
    }, { passive: false });

    // Add keyboard support for desktop testing [web:43]
    document.addEventListener('keydown', function(e) {
        switch(e.key) {
            case 'ArrowLeft':
            case 'a':
            case 'A':
                e.preventDefault();
                moveLeft();
                break;
            case 'ArrowRight':
            case 'd':
            case 'D':
                e.preventDefault();
                moveRight();
                break;
            case ' ':
            case 'Enter':
                e.preventDefault();
                if (!aimingMode) {
                    startVerticalCursorMovement();
                } else {
                    stopVerticalCursorMovement();
                }
                break;
        }
    });
}

function initGameUI() {
    var uiDiv = document.createElement('div');
    uiDiv.id = 'gameUI';
    uiDiv.style.cssText = `
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        z-index: 1000;
    `;
    uiDiv.innerHTML = `
        <h3 style="margin: 0 0 10px 0;">Darts Game</h3>
        <div>Round: <span id="roundDisplay">${roundNumber}/${maxRounds}</span></div>
        <div>Score: <span id="scoreDisplay">${playerScore}</span></div>
        <div>Darts: <span id="dartsDisplay">${dartCount}</span></div>
    `;
    document.body.appendChild(uiDiv);
}

function updateGameUI() {
    document.getElementById('roundDisplay').textContent = `${roundNumber}/${maxRounds}`;
    document.getElementById('scoreDisplay').textContent = playerScore;
    document.getElementById('dartsDisplay').textContent = dartCount;
}

function checkGameEnd() {
    if (roundNumber > maxRounds) {
        gameActive = false;
        showGameOver();
    }
}

function showGameOver() {
    var gameOverScreen = document.createElement('div');
    gameOverScreen.id = 'gameOverScreen';
    gameOverScreen.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-family: Arial, sans-serif;
        z-index: 2000;
    `;
    gameOverScreen.innerHTML = `
        <h1>Game Over!</h1>
        <p style="font-size: 18px;">Final Score: ${playerScore}</p>
        <p style="font-size: 16px;">Rounds Completed: ${roundNumber - 1}</p>
        <button id="restartButton" style="
            padding: 10px 20px;
            font-size: 16px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 20px;
        ">Play Again</button>
    `;
    document.body.appendChild(gameOverScreen);
    
    document.getElementById('restartButton').addEventListener('click', restartGame);
}

function restartGame() {
    playerScore = 0;
    roundNumber = 1;
    dartCount = 3;
    gameActive = true;
    
    document.getElementById('gameOverScreen').remove();
    updateGameUI();
    
    // Reset wind
    generateAngle();
    
    // Reset cursor position
    initCursor();
}

function nextRound() {
    roundNumber++;
    dartCount = 3;
    updateGameUI();
    checkGameEnd();
    
    // Generate new wind for the next round
    if (gameActive) {
        generateAngle();
    }
}

// Modified functions to remove automatic movement
function initWindIndicator(newAngle) {
    var wi = document.getElementById("windIndicator");

    for (i = 0; i < WIND_CELL_COUNT; i++) {
        var newShadow = document.createElement("div");
        var divIdName = "shadow" + i;
        newShadow.setAttribute("id", divIdName);
        newShadow.setAttribute("class", "windCell");
        wi.appendChild(newShadow);
    }

    for (i = 0; i < WIND_CELL_COUNT; i++) {
        var newCell = document.createElement("div");
        var divIdName = "cell" + i;
        newCell.setAttribute("id", divIdName);
        newCell.setAttribute("class", "windCell");
        wi.appendChild(newCell);
    }

    setWindAngle(newAngle);
    startWindAnimation();
}

function setWindAngle(newAngle) {
    wind_angle = newAngle;
    var rad = newAngle * (Math.PI / 180);
    var rad2 = rad - Math.PI;
    var radius = 23;
    var cx = 29;
    var cy = 29;
    var sx = Math.cos(rad2) * radius + cx;
    var sy = Math.sin(rad2) * radius + cy;
    var step = (radius * 2) / WIND_CELL_COUNT;
    var stp = 0;

    for (i = 0; i < WIND_CELL_COUNT; i++) {
        var px = sx + Math.cos(rad) * stp;
        var py = sy + Math.sin(rad) * stp;

        var sh = document.getElementById("shadow" + i);
        sh.style.top = Math.round(py) - 4 + "px";
        sh.style.left = Math.round(px) - 4 + "px";

        var cl = document.getElementById("cell" + i);
        cl.style.top = Math.round(py) - 4 + "px";
        cl.style.left = Math.round(px) - 4 + "px";

        if (WIND_CELL_COUNT - i > windStrenght) {
            cl.style.backgroundPosition = "-9px 0px";
        } else {
            cl.style.backgroundPosition = "-36px 0px";
        }
        stp += step;
    }
}

function startWindAnimation() {
    setInterval("doWindAnimation()", WIND_TIMER);
}

function doWindAnimation() {
    wind_phase++;
    if (wind_phase > 4) wind_phase = 0;

    for (i = 0; i < windStrenght; i++) {
        var state = (wind_phase + i) % 4;
        var offset = -(9 + state * 9);

        var cl = document.getElementById("cell" + (WIND_CELL_COUNT - windStrenght + i));
        cl.style.backgroundPosition = offset + "px 0px";
    }
}

function generateAngle() {
    gameAngle = Math.round(360 * Math.random());
    windStrenght = Math.round(15 * Math.random()) + 5;
    setWindAngle(gameAngle);
}

function getWindXOffset() {
    var a = gameAngle * (Math.PI / 180) - Math.PI;
    var xo = Math.cos(a) * windStrenght;
    return Math.round(xo);
}

function getWindYOffset() {
    var a = gameAngle * (Math.PI / 180) - Math.PI;
    var yo = Math.sin(a) * windStrenght;
    return Math.round(yo);
}

function initPowerBar(xpos, ypos) {
    var el = document.getElementById("power-back");
    el.style.visibility = "visible";
    el.style.top = ypos + "px";
    el.style.left = xpos + "px";

    var el2 = document.getElementById("power");
    el2.style.visibility = "visible";
    setPowerBarProgress(0);
}

function setPowerBarProgress(val) {
    var el = document.getElementById("power");
    el.style.backgroundPosition = "0px " + -(139 - val) + "px";
    el.style.top = 140 - val + "px";
    el.style.height = 150 - (139 - val) + "px";
}

function hidePowerBar() {
    var el = document.getElementById("power-back");
    el.style.visibility = "hidden";
    var el2 = document.getElementById("power");
    el2.style.visibility = "hidden";
}

function initCursor() {
    hand_left = (CURSOR_LEFT + CURSOR_RIGHT) / 2; // Start in center
    hand_top = CURSOR_TOP;
    moveCursor(hand_left, hand_top);
}

function moveCursor(newX, newY) {
    hand_left = newX;
    hand_top = newY;
    var dart = document.getElementById("handCursor");
    dart.style.left = hand_left + "px";
    dart.style.top = hand_top + "px";
}

// REMOVED: doHorizontalCursorMovement() - no longer needed for automatic movement

function doVerticalCursorMovement() {
    hand_top += cursor_ver;

    if (cursor_ver > 0 && hand_top > CURSOR_BOTTOM) {
        hand_top = CURSOR_BOTTOM;
        cursor_ver *= -1;
    }

    if (cursor_ver < 0 && hand_top < CURSOR_TOP) {
        hand_top = CURSOR_TOP;
        cursor_ver *= -1;
    }

    if (SHOW_PROGRESS_BAR == 1) {
        var prog = (hand_top - CURSOR_TOP) * (130 / (CURSOR_BOTTOM - CURSOR_TOP));
        setPowerBarProgress(prog);
    }

    moveCursor(hand_left, hand_top);
}

// REMOVED: startHorizontalCursorMovement() and stopHorizontalCursorMovement()
// These are no longer needed since we use manual controls

function startVerticalCursorMovement() {
    if (firing == 0 && gameActive) {
        aimingMode = true;
        cursorTimerId = setInterval("doVerticalCursorMovement()", CURSOR_TIMER);
        firing = 1;

        if (SHOW_PROGRESS_BAR == 1) {
            initPowerBar(510, 130);
        }

        // Update button state
        var aimBtn = document.getElementById("aimButton");
        if (aimBtn) {
            aimBtn.style.background = "linear-gradient(135deg, #27ae60, #2ecc71)";
            aimBtn.textContent = "AIMING...";
        }
    }
}

function stopVerticalCursorMovement() {
    if (!gameActive) return;
    
    firing = 0;
    aimingMode = false;
    clearInterval(cursorTimerId);

    var fireY = 360 - (hand_top - CURSOR_TOP) * ((BOARD_RADIUS * 2 + 20) / 30) - DART_REF_Y;

    if (WIND_ACTIVE == 1) {
        fireDart(hand_left - DART_REF_X + HAND_REF_X + getWindXOffset() * 4, fireY + getWindYOffset() * 4);
    } else {
        fireDart(hand_left - DART_REF_X + HAND_REF_X, fireY);
    }

    var el = document.getElementById("handCursor");
    el.style.backgroundPosition = "-100px 0px";

    if (SHOW_PROGRESS_BAR == 1) {
        hidePowerBar();
    }

    // Update button state
    var aimBtn = document.getElementById("aimButton");
    if (aimBtn) {
        aimBtn.style.background = "linear-gradient(135deg, #e74c3c, #c0392b)";
        aimBtn.textContent = "AIM";
    }
}

function mouseHandler(evt) {
    if (isMobile) return; // Disable mouse events on mobile

    var node = evt.target ? evt.target : evt.srcElement ? evt.srcElement : null;
    evt = evt ? evt : event ? event : null;

    var xpo = evt.clientX;
    var ypo = evt.clientY;

    var rx = xpo - 350;
    var ry = ypo - 150;

    computeHit(rx, ry);
    generateScore();
    addScoreA(totalScore);
}

function fireDart(tarX, tarY) {
    var dart = document.getElementById("dart");
    dart.style.left = tarX + "px";
    dart.style.top = tarY + "px";
    dart.style.visibility = "visible";

    computeHit(tarX + DART_REF_X, tarY + DART_REF_Y);
    generateScore();
    
    // Add to player score
    playerScore += totalScore;
    
    addScoreA(totalScore);

    dartCount--;
    if (dartCount == 0) {
        nextRound();
    }
    updateGameUI();
    renderIndicator();
    doFlightAnim(0);
}

function generateScore() {
    if (SEGMENT_NAMES[segmentType] == "out") {
        totalScore = 0;
    } else if (SEGMENT_NAMES[segmentType] == "50") {
        totalScore = 50;
    } else {
        if (SEGMENT_NAMES[segmentType] == "25") {
            totalScore = 25;
        } else {
            totalScore = SCORE_VALUES[segment];
            if (SEGMENT_NAMES[segmentType] == "double") totalScore *= 2;
            if (SEGMENT_NAMES[segmentType] == "tripple") totalScore *= 3;
        }
    }
}

function computeHit(xpos, ypos) {
    var dx = BOARD_CENTER_X - xpos;
    var dy = BOARD_CENTER_Y - ypos;
    var angle = Math.atan2(dy, dx);
    var delta = Math.sqrt(dx * dx + dy * dy);

    var sg = 0;
    for (i = 0; i < 6; i++) {
        if (delta > SEGMENTS[i]) sg = i + 1;
    }

    segmentType = sg;
    segmentIndex = Math.round(-angle * (180.0 / Math.PI) + 180.0);
    segment = Math.round(segmentIndex / (360.0 / SEGMENT_COUNT));
}

function addScoreA(msg) {
    var ni = document.getElementById("scoreA");
    var newpar = document.createElement("i");
    newpar.innerHTML = "" + msg + "<br>";
    ni.appendChild(newpar);

    var objDiv = document.getElementById("scoreA");
    objDiv.scrollTop = objDiv.scrollHeight;
}

function showcell(x, y, id) {
    var el = document.getElementById(id);
    var cx = -(x * sprite_cellwidth);
    var cy = -(y * sprite_cellheight);
    el.style.backgroundPosition = cx + "px " + cy + "px";
}

function doFlightAnim(step) {
    dartTimerId = clearTimeout(animId);
    if (step <= 20) {
        showcell(step, 0, "dart");
        dartTimerId = setTimeout("doFlightAnim(" + (step + 1) + ");", FLIGHT_ANIM_DELAY);
    }
}

function renderIndicator() {
    var width = dartCount * 35;
    var drt = document.getElementById("darts");
    drt.style.width = width + "px";
}

// Responsive scaling function
function scaleGame() {
    var gameBox = document.getElementById('gameBox');
    var windowWidth = window.innerWidth;
    var windowHeight = window.innerHeight;
    
    var scaleX = windowWidth / GAME_XRES;
    var scaleY = windowHeight / GAME_YRES;
    var scale = Math.min(scaleX, scaleY, 1);
    
    gameBox.style.transform = 'scale(' + scale + ')';
    gameBox.style.transformOrigin = 'top left';
}

// Initialize everything
window.addEventListener('load', function() {
    initGameUI();
    initMobileControls();
    // REMOVED: startHorizontalCursorMovement(); - no longer automatic
    initCursor(); // Just position the cursor, don't start automatic movement
    initPowerBar(10, 10);
    hidePowerBar();
    initWindIndicator(45);
    generateAngle();
    scaleGame();
});

window.addEventListener('resize', scaleGame);

// Prevent zoom on double tap
var lastTouchEnd = 0;
document.addEventListener('touchend', function (event) {
    var now = (new Date()).getTime();
    if (now - lastTouchEnd <= 300) {
        event.preventDefault();
    }
    lastTouchEnd = now;
}, false);

</script>

</head>

<body onmouseup="mouseHandler(event)" onkeydown="startVerticalCursorMovement()" onkeyup="stopVerticalCursorMovement()">
    <div id="gameBox">
        <div id="windIndicator"></div>
        <div id="darts"></div>
        <div id="power-back" style="visibility: hidden; top: 10px; left: 10px">
            <div id="power" style="visibility: hidden; background-position: 0px -139px; top: 140px; height: 11px;"></div>
        </div>
        <div id="handCursor" style="background-position: 0px 0px; left: 380px; top: 350px"></div>
        <div id="scoreA"></div>
        <div id="dart">&nbsp;</div>
    </div>
</body>
</html>







 <!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>Professional Darts Game</title>
    <style>
        :root {
            --primary-color: #ffcc00;
            --secondary-color: #e74c3c;
            --accent-color: #3498db;
            --dark-bg: #1a1a2e;
            --darker-bg: #0f0f1a;
            --light-text: #ffffff;
            --dark-text: #333333;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --card-bg: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            touch-action: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--light-text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 100vh;
            max-height: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #gameHeader {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        .gameTitle {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }

        #gameStats {
            display: flex;
            gap: 20px;
        }

        .statBox {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--card-bg);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        .statLabel {
            font-size: 12px;
            opacity: 0.8;
        }

        .statValue {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        #gameArea {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameBox {
            position: relative;
            width: 550px;
            height: 400px;
            background-image: url(media/beta-brd2.jpg);
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            white-space: nowrap;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
            border-radius: 10px;
        }

        #dart {
            position: absolute;
            visibility: hidden;
            background-image: url(media/dart-flight.gif);
            left: 300px;
            width: 57px;
            height: 400px;
        }

        #scoreA {
            position: absolute;
            left: 29px;
            top: 135px;
            width: 68px;
            height: 155px;
            text-align: center;
            font-size: 15px;
            color: rgb(255, 255, 255);
            font-weight: bold;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 5px;
            padding: 5px;
        }

        #power-back {
            position: absolute;
            visibility: hidden;
            left: 510px;
            top: 130px;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
            background-position: -36px 0px;
        }

        #power {
            position: absolute;
            visibility: hidden;
            left: 0;
            top: 0;
            width: 36px;
            height: 150px;
            background-image: url(media/pbar.gif);
        }

        #darts {
            position: absolute;
            top: 288px;
            left: 34px;
            width: 115px;
            height: 108px;
            background-image: url(media/darts.png);
        }

        #handCursor {
            position: absolute;
            top: 350px;
            left: 450px;
            width: 100px;
            height: 114px;
            background-image: url(media/hand-csr.gif);
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.7));
        }

        #windIndicator {
            position: absolute;
            top: 11px;
            left: 481px;
            width: 58px;
            height: 58px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            padding: 5px;
        }

        .windCell {
            position: absolute;
            width: 9px;
            height: 9px;
            background-image: url(media/wind.gif);
        }

        #gameUI {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            min-width: 150px;
            backdrop-filter: blur(5px);
            border: 1px solid var(--card-border);
        }

        #gameUI h2 {
            margin: 0 0 10px 0;
            font-size: 16px;
            text-align: center;
            color: var(--primary-color);
        }

        #gameUI div {
            margin: 5px 0;
        }

        #gameUI span {
            font-weight: bold;
            color: var(--primary-color);
        }

        #controlsPanel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 90%;
            max-width: 500px;
            z-index: 1000;
        }

        #directionalControls {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .controlButton {
            width: 70px;
            height: 70px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-color), #2980b9);
            color: white;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.1s ease;
        }

        .controlButton:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        #actionControls {
            display: flex;
            gap: 20px;
        }

        .actionButton {
            padding: 15px 25px;
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .actionButton:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        #aimButton {
            background: linear-gradient(135deg, var(--secondary-color), #c0392b);
        }

        #aimButton.active {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.7);
        }

        #fireButton {
            background: linear-gradient(135deg, var(--warning-color), #e67e22);
        }

        #fireButton:disabled {
            background: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #gameOverScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .gameOverContent {
            background: linear-gradient(135deg, var(--dark-bg), var(--darker-bg));
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--card-border);
            max-width: 500px;
            width: 90%;
        }

        #gameOverScreen h1 {
            font-size: 42px;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
        }

        #gameOverScreen p {
            font-size: 24px;
            margin: 10px 0;
        }

        #finalScore {
            font-size: 36px;
            color: var(--primary-color);
            font-weight: bold;
            margin: 20px 0;
        }

        #restartButton {
            padding: 15px 40px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }

        #restartButton:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        #restartButton:active {
            transform: translateY(0);
        }

        #scorePopup {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-shadow: 0 0 10px rgba(255, 204, 0, 0.7);
            opacity: 0;
            pointer-events: none;
            z-index: 1500;
            transition: all 0.5s ease;
        }

        #instructions {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            z-index: 3000;
            backdrop-filter: blur(10px);
            border: 1px solid var(--card-border);
        }

        #instructions h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        #instructions p {
            margin: 10px 0;
            line-height: 1.5;
        }

        #closeInstructions {
            margin-top: 15px;
            padding: 8px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        @media screen and (max-width: 600px) {
            #gameBox {
                transform: scale(0.8);
            }
            
            .controlButton {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            .actionButton {
                padding: 12px 20px;
                font-size: 16px;
                min-width: 100px;
            }
            
            #gameHeader {
                padding: 8px 15px;
            }
            
            .gameTitle {
                font-size: 20px;
            }
            
            .statBox {
                padding: 6px 12px;
            }
            
            .statValue {
                font-size: 16px;
            }
        }

        @media screen and (max-width: 480px) {
            #gameBox {
                transform: scale(0.6);
            }
            
            #controlsPanel {
                bottom: 10px;
            }
            
            .controlButton {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .actionButton {
                padding: 10px 15px;
                font-size: 14px;
                min-width: 90px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <div id="gameHeader">
            <div class="gameTitle">PRO DARTS</div>
            <div id="gameStats">
                <div class="statBox">
                    <div class="statLabel">ROUND</div>
                    <div class="statValue" id="roundDisplay">1/3</div>
                </div>
                <div class="statBox">
                    <div class="statLabel">SCORE</div>
                    <div class="statValue" id="scoreDisplay">0</div>
                </div>
                <div class="statBox">
                    <div class="statLabel">DARTS</div>
                    <div class="statValue" id="dartsDisplay">3</div>
                </div>
            </div>
        </div>
        
        <div id="gameArea">
            <div id="gameBox">
                <div id="windIndicator"></div>
                <div id="darts"></div>
                <div id="power-back" style="visibility: hidden; top: 10px; left: 10px">
                    <div id="power" style="visibility: hidden; background-position: 0px -139px; top: 140px; height: 11px;"></div>
                </div>
                <div id="handCursor" style="background-position: 0px 0px; left: 380px; top: 350px"></div>
                <div id="scoreA"></div>
                <div id="dart">&nbsp;</div>
                <div id="scorePopup"></div>
            </div>
        </div>
        
        <div id="controlsPanel">
            <div id="directionalControls">
                <button class="controlButton" id="leftButton">←</button>
                <div style="width: 100px; text-align: center; font-size: 12px; opacity: 0.8;">AIM</div>
                <button class="controlButton" id="rightButton">→</button>
            </div>
            <div id="actionControls">
                <button class="actionButton" id="aimButton">AIM</button>
                <button class="actionButton" id="fireButton">FIRE</button>
            </div>
        </div>
    </div>

    <div id="gameOverScreen">
        <div class="gameOverContent">
            <h1>GAME OVER</h1>
            <p>Your Final Score:</p>
            <div id="finalScore">0</div>
            <p>Rounds Completed: <span id="roundsCompleted">0</span></p>
            <button id="restartButton">PLAY AGAIN</button>
        </div>
    </div>

    <div id="instructions">
        <h3>HOW TO PLAY</h3>
        <p>Use LEFT and RIGHT buttons to aim horizontally</p>
        <p>Press AIM to start vertical aiming, then FIRE to throw</p>
        <p>Complete 3 rounds to finish the game</p>
        <p>Try to score as high as possible!</p>
        <button id="closeInstructions">GOT IT!</button>
    </div>

    <script>
        // Game variables
        var SHOW_PROGRESS_BAR = 1;
        var WIND_ACTIVE = 1;

        var GAME_XRES = 550;
        var GAME_YRES = 400;

        var HAND_REF_X = 12;

        var BOARD_CENTER_X = 363;
        var BOARD_CENTER_Y = 201;
        var BOARD_RADIUS = 154;

        var OFFSET_POINT_X = 515;
        var OFFSET_POINT_Y = 176;

        var SEGMENT_COUNT = 20;
        var SEGMENT_SIZE = Math.PI / 10.0;

        var SEGMENTS = [10, 21, 77, 90, 141, 154];
        var SEGMENT_NAMES = ["50", "25", "value", "tripple", "value", "double", "out"];

        var angleOffset = Math.round(-Math.atan2(BOARD_CENTER_Y - OFFSET_POINT_Y, BOARD_CENTER_X - OFFSET_POINT_X) * (180.0 / Math.PI) + 180.0);

        var SCORE_VALUES = [6, 13, 4, 18, 1, 20, 5, 12, 9, 14, 11, 8, 16, 7, 19, 3, 17, 2, 15, 10, 6];

        var targetAngle = 0;
        var targetDelta = 0;
        var targetDX = 0;
        var targetDY = 0;

        var segmentIndex = 0;
        var segmentType = 0;
        var segmentAngle = 0;
        var segment = 0;
        var totalScore = 0;

        var DART_REF_X = 34;
        var DART_REF_Y = 66;

        var FLIGHT_ANIM_DELAY = 20;

        var dartCount = 3;
        var ligthOn = 0;

        var CURSOR_LEFT = 193;
        var CURSOR_RIGHT = 530;
        var CURSOR_TOP = 350;
        var CURSOR_BOTTOM = 380;

        var CURSOR_HOR_STEP = 15;
        var CURSOR_VER_STEP = 1;

        var cursor_ver = CURSOR_VER_STEP;
        var CURSOR_TIMER = 50;

        var hand_top = 350;
        var hand_left = 450;

        var cursorTimerId = 0;
        var dartTimerId = 1;

        var firing = 0;
        var aimingMode = false;
        var horizontalMovementActive = false;

        var wind_angle = 0;
        var wind_phase = 0;

        var WIND_CELL_COUNT = 20;
        var WIND_TIMER = 300;

        var wind_cell_x = [WIND_CELL_COUNT];
        var wind_cell_y = [WIND_CELL_COUNT];

        var gameAngle = 0;
        var windStrenght = 0;

        var sprite_cellwidth = 57;
        var sprite_cellheight = 400;
        var sprite_cellnum = 21;
        var animId;

        // Single player game variables
        var playerScore = 0;
        var roundNumber = 1;
        var maxRounds = 3;
        var gameActive = true;

        // Mobile detection
        var isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        // Initialize the game
       function initGame() {
    initMobileControls();
    initCursor();
    initPowerBar(10, 10);
    hidePowerBar();
    initWindIndicator(45);
    generateAngle();
    updateGameUI();
    
    // Show instructions on first load - make sure we're using the right display property
    setTimeout(function() {
        var instructions = document.getElementById("instructions");
        if (instructions) {
            instructions.style.display = "block"; // Changed from 'flex' to 'block'
            console.log("Instructions shown");
        }
    }, 500);
}

        // Manual movement functions
        function moveLeft() {
            if (!aimingMode && !firing && gameActive) {
                hand_left -= CURSOR_HOR_STEP;
                if (hand_left < CURSOR_LEFT) {
                    hand_left = CURSOR_LEFT;
                }
                moveCursor(hand_left, hand_top);
            }
        }

        function moveRight() {
            if (!aimingMode && !firing && gameActive) {
                hand_left += CURSOR_HOR_STEP;
                if (hand_left > CURSOR_RIGHT) {
                    hand_left = CURSOR_RIGHT;
                }
                moveCursor(hand_left, hand_top);
            }
        }

      function initMobileControls() {
    var leftBtn = document.getElementById("leftButton");
    var rightBtn = document.getElementById("rightButton");
    var aimBtn = document.getElementById("aimButton");
    var fireBtn = document.getElementById("fireButton");

    // Left button events
    leftBtn.addEventListener("touchstart", function(e) {
        e.preventDefault();
        moveLeft();
    });
    leftBtn.addEventListener("touchend", function(e) {
        e.preventDefault();
    });
    leftBtn.addEventListener("click", function(e) {
        e.preventDefault();
        moveLeft();
    });

    // Right button events
    rightBtn.addEventListener("touchstart", function(e) {
        e.preventDefault();
        moveRight();
    });
    rightBtn.addEventListener("touchend", function(e) {
        e.preventDefault();
    });
    rightBtn.addEventListener("click", function(e) {
        e.preventDefault();
        moveRight();
    });

    // Aim button events
    aimBtn.addEventListener("touchstart", function(e) {
        e.preventDefault();
        startVerticalCursorMovement();
    });
    aimBtn.addEventListener("touchend", function(e) {
        e.preventDefault();
    });
    aimBtn.addEventListener("click", function(e) {
        e.preventDefault();
        startVerticalCursorMovement();
    });

    // Fire button events
    fireBtn.addEventListener("touchstart", function(e) {
        e.preventDefault();
        stopVerticalCursorMovement();
    });
    fireBtn.addEventListener("touchend", function(e) {
        e.preventDefault();
    });
    fireBtn.addEventListener("click", function(e) {
        e.preventDefault();
        stopVerticalCursorMovement();
    });

    // Close instructions - with safety check and better event handling
    var closeInstructionsBtn = document.getElementById("closeInstructions");
    if (closeInstructionsBtn) {
        console.log("Close instructions button found, adding event listener");
        
        closeInstructionsBtn.addEventListener("click", function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("Close instructions button clicked");
            var instructions = document.getElementById("instructions");
            if (instructions) {
                instructions.style.display = "none";
                console.log("Instructions hidden");
            }
        });
        
        // Also add touch events for mobile
        closeInstructionsBtn.addEventListener("touchstart", function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log("Close instructions touch start");
            document.getElementById("instructions").style.display = "none";
        });
    } else {
        console.log("Close instructions button NOT found");
    }

    // Prevent default touch behaviors
    document.addEventListener("touchmove", function(e) {
        e.preventDefault();
    }, { passive: false });

    document.addEventListener("touchstart", function(e) {
        if (e.target.tagName !== "BUTTON") {
            e.preventDefault();
        }
    }, { passive: false });

    // Add keyboard support for desktop testing
    document.addEventListener("keydown", function(e) {
        switch(e.key) {
            case "ArrowLeft":
            case "a":
            case "A":
                e.preventDefault();
                moveLeft();
                break;
            case "ArrowRight":
            case "d":
            case "D":
                e.preventDefault();
                moveRight();
                break;
            case " ":
            case "Enter":
                e.preventDefault();
                if (!aimingMode) {
                    startVerticalCursorMovement();
                } else {
                    stopVerticalCursorMovement();
                }
                break;
        }
    });
}
        function updateGameUI() {
            document.getElementById("roundDisplay").textContent = `${roundNumber}/${maxRounds}`;
            document.getElementById("scoreDisplay").textContent = playerScore;
            document.getElementById("dartsDisplay").textContent = dartCount;
        }

        function checkGameEnd() {
            if (roundNumber > maxRounds) {
                gameActive = false;
                showGameOver();
            }
        }

        function showGameOver() {
            document.getElementById("finalScore").textContent = playerScore;
            document.getElementById("roundsCompleted").textContent = roundNumber - 1;
            document.getElementById("gameOverScreen").style.display = "flex";
        }

        function restartGame() {
            playerScore = 0;
            roundNumber = 1;
            dartCount = 3;
            gameActive = true;
            
            document.getElementById("gameOverScreen").style.display = "none";
            updateGameUI();
            
            // Reset wind
            generateAngle();
            
            // Reset cursor position
            initCursor();
            
            // Clear score display
            document.getElementById("scoreA").innerHTML = "";
        }

        function nextRound() {
            roundNumber++;
            dartCount = 3;
            updateGameUI();
            checkGameEnd();
            
            // Generate new wind for the next round
            if (gameActive) {
                generateAngle();
            }
        }

        function showScorePopup(score, x, y) {
            var popup = document.getElementById("scorePopup");
            popup.textContent = "+" + score;
            popup.style.left = x + "px";
            popup.style.top = y + "px";
            popup.style.opacity = "1";
            
            setTimeout(function() {
                popup.style.opacity = "0";
                popup.style.top = (parseInt(popup.style.top) - 50) + "px";
            }, 500);
        }

        // Wind functions
        function initWindIndicator(newAngle) {
            var wi = document.getElementById("windIndicator");

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newShadow = document.createElement("div");
                var divIdName = "shadow" + i;
                newShadow.setAttribute("id", divIdName);
                newShadow.setAttribute("class", "windCell");
                wi.appendChild(newShadow);
            }

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var newCell = document.createElement("div");
                var divIdName = "cell" + i;
                newCell.setAttribute("id", divIdName);
                newCell.setAttribute("class", "windCell");
                wi.appendChild(newCell);
            }

            setWindAngle(newAngle);
            startWindAnimation();
        }

        function setWindAngle(newAngle) {
            wind_angle = newAngle;
            var rad = newAngle * (Math.PI / 180);
            var rad2 = rad - Math.PI;
            var radius = 23;
            var cx = 29;
            var cy = 29;
            var sx = Math.cos(rad2) * radius + cx;
            var sy = Math.sin(rad2) * radius + cy;
            var step = (radius * 2) / WIND_CELL_COUNT;
            var stp = 0;

            for (i = 0; i < WIND_CELL_COUNT; i++) {
                var px = sx + Math.cos(rad) * stp;
                var py = sy + Math.sin(rad) * stp;

                var sh = document.getElementById("shadow" + i);
                sh.style.top = Math.round(py) - 4 + "px";
                sh.style.left = Math.round(px) - 4 + "px";

                var cl = document.getElementById("cell" + i);
                cl.style.top = Math.round(py) - 4 + "px";
                cl.style.left = Math.round(px) - 4 + "px";

                if (WIND_CELL_COUNT - i > windStrenght) {
                    cl.style.backgroundPosition = "-9px 0px";
                } else {
                    cl.style.backgroundPosition = "-36px 0px";
                }
                stp += step;
            }
        }

        function startWindAnimation() {
            setInterval("doWindAnimation()", WIND_TIMER);
        }

        function doWindAnimation() {
            wind_phase++;
            if (wind_phase > 4) wind_phase = 0;

            for (i = 0; i < windStrenght; i++) {
                var state = (wind_phase + i) % 4;
                var offset = -(9 + state * 9);

                var cl = document.getElementById("cell" + (WIND_CELL_COUNT - windStrenght + i));
                cl.style.backgroundPosition = offset + "px 0px";
            }
        }

        function generateAngle() {
            gameAngle = Math.round(360 * Math.random());
            windStrenght = Math.round(15 * Math.random()) + 5;
            setWindAngle(gameAngle);
        }

        function getWindXOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var xo = Math.cos(a) * windStrenght;
            return Math.round(xo);
        }

        function getWindYOffset() {
            var a = gameAngle * (Math.PI / 180) - Math.PI;
            var yo = Math.sin(a) * windStrenght;
            return Math.round(yo);
        }

        function initPowerBar(xpos, ypos) {
            var el = document.getElementById("power-back");
            el.style.visibility = "visible";
            el.style.top = ypos + "px";
            el.style.left = xpos + "px";

            var el2 = document.getElementById("power");
            el2.style.visibility = "visible";
            setPowerBarProgress(0);
        }

        function setPowerBarProgress(val) {
            var el = document.getElementById("power");
            el.style.backgroundPosition = "0px " + -(139 - val) + "px";
            el.style.top = 140 - val + "px";
            el.style.height = 150 - (139 - val) + "px";
        }

        function hidePowerBar() {
            var el = document.getElementById("power-back");
            el.style.visibility = "hidden";
            var el2 = document.getElementById("power");
            el2.style.visibility = "hidden";
        }

        function initCursor() {
            hand_left = (CURSOR_LEFT + CURSOR_RIGHT) / 2;
            hand_top = CURSOR_TOP;
            moveCursor(hand_left, hand_top);
        }

        function moveCursor(newX, newY) {
            hand_left = newX;
            hand_top = newY;
            var dart = document.getElementById("handCursor");
            dart.style.left = hand_left + "px";
            dart.style.top = hand_top + "px";
        }

        function doVerticalCursorMovement() {
            hand_top += cursor_ver;

            if (cursor_ver > 0 && hand_top > CURSOR_BOTTOM) {
                hand_top = CURSOR_BOTTOM;
                cursor_ver *= -1;
            }

            if (cursor_ver < 0 && hand_top < CURSOR_TOP) {
                hand_top = CURSOR_TOP;
                cursor_ver *= -1;
            }

            if (SHOW_PROGRESS_BAR == 1) {
                var prog = (hand_top - CURSOR_TOP) * (130 / (CURSOR_BOTTOM - CURSOR_TOP));
                setPowerBarProgress(prog);
            }

            moveCursor(hand_left, hand_top);
        }

        function startVerticalCursorMovement() {
            if (firing == 0 && gameActive) {
                aimingMode = true;
                cursorTimerId = setInterval("doVerticalCursorMovement()", CURSOR_TIMER);
                firing = 1;

                if (SHOW_PROGRESS_BAR == 1) {
                    initPowerBar(510, 130);
                }

                // Update button state
                var aimBtn = document.getElementById("aimButton");
                if (aimBtn) {
                    aimBtn.classList.add("active");
                }
            }
        }

        function stopVerticalCursorMovement() {
            if (!gameActive) return;
            
            firing = 0;
            aimingMode = false;
            clearInterval(cursorTimerId);

            var fireY = 360 - (hand_top - CURSOR_TOP) * ((BOARD_RADIUS * 2 + 20) / 30) - DART_REF_Y;

            if (WIND_ACTIVE == 1) {
                fireDart(hand_left - DART_REF_X + HAND_REF_X + getWindXOffset() * 4, fireY + getWindYOffset() * 4);
            } else {
                fireDart(hand_left - DART_REF_X + HAND_REF_X, fireY);
            }

            var el = document.getElementById("handCursor");
            el.style.backgroundPosition = "-100px 0px";

            if (SHOW_PROGRESS_BAR == 1) {
                hidePowerBar();
            }

            // Update button state
            var aimBtn = document.getElementById("aimButton");
            if (aimBtn) {
                aimBtn.classList.remove("active");
            }
        }

        function mouseHandler(evt) {
            if (isMobile) return;

            var node = evt.target ? evt.target : evt.srcElement ? evt.srcElement : null;
            evt = evt ? evt : event ? event : null;

            var xpo = evt.clientX;
            var ypo = evt.clientY;

            var rx = xpo - 350;
            var ry = ypo - 150;

            computeHit(rx, ry);
            generateScore();
            addScoreA(totalScore);
        }

        function fireDart(tarX, tarY) {
            var dart = document.getElementById("dart");
            dart.style.left = tarX + "px";
            dart.style.top = tarY + "px";
            dart.style.visibility = "visible";

            computeHit(tarX + DART_REF_X, tarY + DART_REF_Y);
            generateScore();
            
            // Add to player score
            playerScore += totalScore;
            
            addScoreA(totalScore);
            
            // Show score popup
            showScorePopup(totalScore, tarX + DART_REF_X, tarY + DART_REF_Y);

            dartCount--;
            if (dartCount == 0) {
                nextRound();
            }
            updateGameUI();
            renderIndicator();
            doFlightAnim(0);
        }

        function generateScore() {
            if (SEGMENT_NAMES[segmentType] == "out") {
                totalScore = 0;
            } else if (SEGMENT_NAMES[segmentType] == "50") {
                totalScore = 50;
            } else {
                if (SEGMENT_NAMES[segmentType] == "25") {
                    totalScore = 25;
                } else {
                    totalScore = SCORE_VALUES[segment];
                    if (SEGMENT_NAMES[segmentType] == "double") totalScore *= 2;
                    if (SEGMENT_NAMES[segmentType] == "tripple") totalScore *= 3;
                }
            }
        }

        function computeHit(xpos, ypos) {
            var dx = BOARD_CENTER_X - xpos;
            var dy = BOARD_CENTER_Y - ypos;
            var angle = Math.atan2(dy, dx);
            var delta = Math.sqrt(dx * dx + dy * dy);

            var sg = 0;
            for (i = 0; i < 6; i++) {
                if (delta > SEGMENTS[i]) sg = i + 1;
            }

            segmentType = sg;
            segmentIndex = Math.round(-angle * (180.0 / Math.PI) + 180.0);
            segment = Math.round(segmentIndex / (360.0 / SEGMENT_COUNT));
        }

        function addScoreA(msg) {
            var ni = document.getElementById("scoreA");
            var newpar = document.createElement("i");
            newpar.innerHTML = "" + msg + "<br>";
            ni.appendChild(newpar);

            var objDiv = document.getElementById("scoreA");
            objDiv.scrollTop = objDiv.scrollHeight;
        }

        function showcell(x, y, id) {
            var el = document.getElementById(id);
            var cx = -(x * sprite_cellwidth);
            var cy = -(y * sprite_cellheight);
            el.style.backgroundPosition = cx + "px " + cy + "px";
        }

        function doFlightAnim(step) {
            dartTimerId = clearTimeout(animId);
            if (step <= 20) {
                showcell(step, 0, "dart");
                dartTimerId = setTimeout("doFlightAnim(" + (step + 1) + ");", FLIGHT_ANIM_DELAY);
            }
        }

        function renderIndicator() {
            var width = dartCount * 35;
            var drt = document.getElementById("darts");
            drt.style.width = width + "px";
        }

        // Initialize everything
        window.addEventListener("load", function() {
            initGame();
            
            // Add restart button event listener
            document.getElementById("restartButton").addEventListener("click", restartGame);
        });

        // Prevent zoom on double tap
        var lastTouchEnd = 0;
        document.addEventListener("touchend", function (event) {
            var now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
    </script>
</body>
</html> -->